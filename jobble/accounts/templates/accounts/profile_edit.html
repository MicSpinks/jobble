{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container py-4">
  <h1>{{ user.username }}'s Profile</h1>
  <form method="post">
    {% csrf_token %}
    <div class="mb-3">
      {{ template_data.form.fname.label_tag }}
      {{ template_data.form.fname }}

      {{ template_data.form.lname.label_tag }}
      {{ template_data.form.lname }}
    </div>
    <div class="mb-3">
      {{ template_data.form.headline.label_tag }}
      {{ template_data.form.headline }}
    </div>
    <div class="mb-3">
      {{ template_data.form.skills.label_tag }}
      {{ template_data.form.skills }}
    </div>
    <div class="mb-3">
      {{ template_data.form.education.label_tag }}
      <div id="education-container">
        {% if template_data.education_list is not None %}
          {% if template_data.education_list %}
            {% for line in template_data.education_list %}
              <div class="input-group mb-2 edu-row">
                <input type="text" name="education_lines" class="form-control" value="{{ line }}" />
                <button type="button" class="btn btn-outline-danger remove-edu">Remove</button>
              </div>
            {% endfor %}
          {% else %}
            <div class="input-group mb-2 edu-row">
              <input type="text" name="education_lines" class="form-control" value="" />
              <button type="button" class="btn btn-outline-danger remove-edu">Remove</button>
            </div>
          {% endif %}
        {% else %}
          <div class="input-group mb-2 edu-row">
            <input type="text" name="education_lines" class="form-control" value="" />
            <button type="button" class="btn btn-outline-danger remove-edu">Remove</button>
          </div>
        {% endif %}
      </div>
      <button id="add-education" type="button" class="btn btn-secondary btn-sm">Add education line</button>
    </div>
    <div class="mb-3">
      {{ template_data.form.work_experience.label_tag }}
      <div id="work-container">
        {% if template_data.work_list is not None %}
          {% if template_data.work_list %}
            {% for line in template_data.work_list %}
              <div class="input-group mb-2 work-row">
                <input type="text" name="work_lines" class="form-control" value="{{ line }}" />
                <button type="button" class="btn btn-outline-danger remove-work">Remove</button>
              </div>
            {% endfor %}
          {% else %}
            <div class="input-group mb-2 work-row">
              <input type="text" name="work_lines" class="form-control" value="" />
              <button type="button" class="btn btn-outline-danger remove-work">Remove</button>
            </div>
          {% endif %}
        {% else %}
          <div class="input-group mb-2 work-row">
            <input type="text" name="work_lines" class="form-control" value="" />
            <button type="button" class="btn btn-outline-danger remove-work">Remove</button>
          </div>
        {% endif %}
      </div>
      <button id="add-work" type="button" class="btn btn-secondary btn-sm">Add work line</button>
    </div>
    <div class="mb-3">
      {{ template_data.form.location.label_tag }}
      {{ template_data.form.location }}
    </div>
    <div class="mb-3">
        {{ template_data.form.links.label_tag }}
        <div id="links-container">
          {% if template_data.links_list %}
            {% for l in template_data.links_list %}
              <div class="input-group mb-2 link-row">
                <input type="text" name="links" class="form-control" value="{{ l }}" />
                <button type="button" class="btn btn-outline-danger remove-link">Remove</button>
              </div>
            {% endfor %}
          {% else %}
            <div class="input-group mb-2 link-row">
              <input type="text" name="links" class="form-control" value="" />
              <button type="button" class="btn btn-outline-danger remove-link">Remove</button>
            </div>
          {% endif %}
        </div>
        <button id="add-link" type="button" class="btn btn-secondary btn-sm">Add another link</button>
    </div>

    <h4>Privacy settings</h4>
    <div class="form-check">
      {{ template_data.form.show_headline }} {{ template_data.form.show_headline.label_tag }}
    </div>
    <div class="form-check">
      {{ template_data.form.show_skills }} {{ template_data.form.show_skills.label_tag }}
    </div>
    <div class="form-check">
      {{ template_data.form.show_education }} {{ template_data.form.show_education.label_tag }}
    </div>
    <div class="form-check">
      {{ template_data.form.show_work_experience }} {{ template_data.form.show_work_experience.label_tag }}
    </div>
    <div class="form-check">
      {{ template_data.form.show_location }} {{ template_data.form.show_location.label_tag }}
    </div>
    <div class="form-check mb-3">
      {{ template_data.form.show_links }} {{ template_data.form.show_links.label_tag }}
    </div>

    <button class="btn btn-primary" type="submit">Save</button>
  </form>
</div>

<script>
// script to add/remove link input boxes
document.addEventListener('click', function(e){
  if(e.target && e.target.id === 'add-link'){
    const container = document.getElementById('links-container');
    const div = document.createElement('div');
    div.className = 'input-group mb-2 link-row';
    div.innerHTML = '<input type="text" name="links" class="form-control" value="" />'
                  + '<button type="button" class="btn btn-outline-danger remove-link">Remove</button>';
    container.appendChild(div);
  }
  if(e.target && e.target.classList && e.target.classList.contains('remove-link')){
    const row = e.target.closest('.link-row');
    if(row) row.remove();
  }
  // education add/remove
  if(e.target && e.target.id === 'add-education'){
    const container = document.getElementById('education-container');
    const div = document.createElement('div');
    div.className = 'input-group mb-2 edu-row';
    div.innerHTML = '<input type="text" name="education_lines" class="form-control" value="" />'
                  + '<button type="button" class="btn btn-outline-danger remove-edu">Remove</button>';
    container.appendChild(div);
  }
  if(e.target && e.target.classList && e.target.classList.contains('remove-edu')){
    const row = e.target.closest('.edu-row');
    if(row) row.remove();
  }
  // work experience add/remove
  if(e.target && e.target.id === 'add-work'){
    const container = document.getElementById('work-container');
    const div = document.createElement('div');
    div.className = 'input-group mb-2 work-row';
    div.innerHTML = '<input type="text" name="work_lines" class="form-control" value="" />'
                  + '<button type="button" class="btn btn-outline-danger remove-work">Remove</button>';
    container.appendChild(div);
  }
  if(e.target && e.target.classList && e.target.classList.contains('remove-work')){
    const row = e.target.closest('.work-row');
    if(row) row.remove();
  }
});
</script>
{% endblock content %}